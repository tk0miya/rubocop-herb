#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "rubocop/herb"
require "optparse"

options = { html_visualization: true }
OptionParser.new do |opts|
  opts.banner = "Usage: #{$PROGRAM_NAME} [options] < file.erb"

  opts.on("--disable-html-visualization", "Disable HTML visualization") do
    options[:html_visualization] = false
  end

  opts.on("-h", "--help", "Show this help message") do
    puts opts
    exit
  end
end.parse!

source = $stdin.read
result = RuboCop::Herb::Converter.new(html_visualization: options[:html_visualization]).convert("(stdin)", source)

if result.nil?
  warn "Error: Failed to parse ERB"
  exit 1
end

puts result.ruby_code
